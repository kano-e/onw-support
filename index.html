<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ワンナイト人狼 サポートツール</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
    <link href="main.css" media="all" rel="stylesheet" />
  </head>

  <body>
    <div class="header">
      <h1>ワンナイト人狼 サポートツール</h1>
    </div>

    <div class="gettingDark">
      <form class="pure-form">
        <p>
          <label>カウント</label>
          <select id="countupSelect">
            <option>3</option>
            <option selected="selected">5</option>
            <option>8</option>
            <option>10</option>
          </select>
        </p>

        <button class="button-xlarge pure-button" id="gettingDarkButton">夜になります</button>
      </form>
    </div>

    <div class="detail">
      <p><a href="http://1nite-jinro.strikingly.com/">ワンナイト人狼</a>を遊んでいて、</p>
      <ul>
        <li>マスターが狼になって顔を上げたら、声の響きで正体がバレてしまった</li>
        <li>マスターが声を出すタイミングに気をとられて、占い師や怪盗の仕事に集中できない</li>
      </ul>
      <p>こんなこまった事態があったので、サポートツールを作りました。</p>

      <p>「夜になります」ボタンを押すと、自動で文章を読み上げ始めますので、後は指示に従ってください。</p>

      <p>Web Speech API を利用しています。<br/>
      iOS Safari でしか動作確認していません。</p>
    </div>

    <div class="footer">
      <p>オススメ</p>
      <p>
      <a href="http://www.amazon.co.jp/gp/product/B00DS4125C/ref=as_li_tf_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00DS4125C&linkCode=as2&tag=onw-support-22"><img border="0" src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00DS4125C&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=onw-support-22" ></a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=onw-support-22&l=as2&o=9&a=B00DS4125C" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
      <a href="http://www.amazon.co.jp/gp/product/B00Q2GME6Y/ref=as_li_tf_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00Q2GME6Y&linkCode=as2&tag=onw-support-22"><img border="0" src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00Q2GME6Y&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=onw-support-22" ></a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=onw-support-22&l=as2&o=9&a=B00Q2GME6Y" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
      </p>
      <p><a type="amzn" search="ワンナイト人狼">ワンナイト人狼</a></p>
    </div>

    <script>
        var btn = document.getElementById('gettingDarkButton');

        var buildSynthesJP = function(text) {
          var synthes = new SpeechSynthesisUtterance(text);
          synthes.lang = "ja-JP"
          synthes.rate = 0.5;
          synthes.pitch = 1;
          return synthes;
        };

        var speakJP = function(text) {
          speechSynthesis.speak(buildSynthesJP(text));
        };

        var seeds = {
          start: [
            [ 5000, '夜になりました。みなさん、顔を伏せて机を軽く叩いてください。' ]
          ],
          fortuneteller: {
            start: [
              [ 8000, '占い師の方、占い師の方。顔をあげて、誰か一人の正体を占ってください。' ]
            ],
            finish: [
              [ 8000, '占い師の方、顔を伏せてください。' ]
            ]
          },
          wolf: {
            start: [
              [ 8000, '狼の方、狼の方。スパイの方、スパイの方。顔をあげて、仲間を確認してください。' ]
            ],
            finish: [
              [ 8000, 'みなさん、顔を伏せてください。' ]
            ]
          },
          thief: {
            start: [
              [ 8000, '怪盗の方、怪盗の方。誰かと正体を交換してください。交換後のカードの確認を忘れないようにしてください。' ]
            ],
            finish: [
              [ 8000, '怪盗の方、顔を伏せてください。' ]
            ]
          },
          finish: [
            [ 8000, '朝になりました。みなさん、目覚めて顔をあげましょう。' ]
          ],
          countup: [
            [ 1500, 'いち' ],
            [ 1500, 'にい' ],
            [ 1500, 'さん' ],
            [ 1500, 'よん' ],
            [ 1500, 'ごお' ],
            [ 1500, 'ろく' ],
            [ 1500, 'なな' ],
            [ 1500, 'はち' ],
            [ 1500, 'きゅう' ],
            [ 1500, 'じゅう' ],
          ]
        };

        var nextSpeech = function(scenario, i) {
          if (scenario[i] == undefined) return;

          var time = scenario[i][0];
          var text = scenario[i][1];
          speakJP(text);

          setTimeout(function(i) {
            nextSpeech(scenario, i + 1);
          }, time, i);
        };

        var buildScenario = function(countup) {
          var scenario = [];
          var push = Array.prototype.push;
          push.apply(scenario, seeds['start']);
          if (countup > 10) countup = 10;

          if (countup <= 0) push.apply(scenario, [[8000, 'カウントは行いません。']]);
          else push.apply(scenario, [[8000, 'カウントは、' + countup + 'までです。']]);

          push.apply(scenario, seeds['fortuneteller']['start']);
          push.apply(scenario, seeds['countup'].slice(0, countup));
          push.apply(scenario, seeds['fortuneteller']['finish']);

          push.apply(scenario, seeds['wolf']['start']);
          push.apply(scenario, seeds['countup'].slice(0, countup));
          push.apply(scenario, seeds['wolf']['finish']);

          push.apply(scenario, seeds['thief']['start']);
          push.apply(scenario, seeds['countup'].slice(0, countup));
          push.apply(scenario, seeds['thief']['finish']);

          push.apply(scenario, seeds['finish']);

          return scenario;
        };

        btn.addEventListener('click', function(event) {
          var countup = Number(document.getElementById('countupSelect').value);
          var scenario = buildScenario(countup);
          setTimeout(function() { nextSpeech(scenario, 0); }, 1000);
          event.preventDefault();
        }, false);
    </script>

    <SCRIPT charset="utf-8" type="text/javascript" src="http://ws-fe.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&MarketPlace=JP&ID=V20070822%2FJP%2Famazontail-22%2F8005%2F10281f4d-de6b-4e6a-a04e-d260a015df1a"> </SCRIPT> <NOSCRIPT><A HREF="http://ws-fe.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&MarketPlace=JP&ID=V20070822%2FJP%2Famazontail-22%2F8005%2F10281f4d-de6b-4e6a-a04e-d260a015df1a&Operation=NoScript">Amazon.co.jp ウィジェット</A></NOSCRIPT>
  </body>
</html>
